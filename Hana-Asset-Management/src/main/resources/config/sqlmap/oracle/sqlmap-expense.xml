<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="expense.ExpenseDAO">

	<resultMap type="expenseVO" id="expenseMap">
		<result column="member_id" property="memberId"/>
	</resultMap>

	<select id="selectList" parameterType="expenseVO" resultMap="expenseMap">
		select member_id,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '20/09/01' and '20/09/30') sep,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '20/10/01' and '20/10/31') oct,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '20/11/01' and '20/11/30') nov,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '20/12/01' and '20/12/31') dec,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/01/01' and '21/01/31') jan,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/02/01' and '21/02/28') feb,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/03/01' and '21/03/31') mar,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/04/01' and '21/04/30') apr,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/05/01' and '21/05/31') may,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/06/01' and '21/06/30') jun,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/07/01' and '21/07/31') jul,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/08/01' and '21/08/31') aug
			 from CM_DETAIL_EXPENDITURE
			  where MEMBER_ID = #{memberId}
			   group by MEMBER_ID
	</select>
	
	<select id="selectList2" parameterType="expenseVO" resultMap="expenseMap">
		select member_id,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/03/01' and '21/03/31') mar,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/04/01' and '21/04/30') apr,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/05/01' and '21/05/31') may,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/06/01' and '21/06/30') jun,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/07/01' and '21/07/31') jul,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/08/01' and '21/08/31') aug
			 from CM_DETAIL_EXPENDITURE
			  where MEMBER_ID = #{memberId}
			   group by MEMBER_ID
	</select>
	
	<select id="selectList3" parameterType="expenseVO" resultMap="expenseMap">
		select member_id,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/06/01' and '21/06/30') jun,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/07/01' and '21/07/31') jul,
			(select sum(cost) from CM_DETAIL_EXPENDITURE where member_id = #{memberId} and REG_DATE BETWEEN '21/08/01' and '21/08/31') aug
			 from CM_DETAIL_EXPENDITURE
			  where MEMBER_ID = #{memberId}
			   group by MEMBER_ID
	</select>
	
	<select id="pieChartData" parameterType="expenseVO" resultMap="expenseMap">
		select sum(cost) expense, category
		 from CM_DETAIL_EXPENDITURE
		  where MEMBER_ID = #{memberId} and REG_DATE BETWEEN '21-08-01'and '21-08-31'
		   group by member_id, category
	</select>
	
	<select id="pieChartData2" parameterType="expenseVO" resultMap="expenseMap">
		select sum(cost) expense, category
		 from CM_DETAIL_EXPENDITURE
		  where MEMBER_ID = #{memberId} and REG_DATE BETWEEN '21-06-01'and '21-08-31'
		   group by member_id, category
	</select>
	
	<select id="pieChartData3" parameterType="expenseVO" resultMap="expenseMap">
		select sum(cost) expense, category
		 from CM_DETAIL_EXPENDITURE
		  where MEMBER_ID = #{memberId} and REG_DATE BETWEEN '21-03-01'and '21-08-31'
		   group by member_id, category
	</select>
	
	<select id="pieChartData4" parameterType="expenseVO" resultMap="expenseMap">
		select sum(cost) expense, category
		 from CM_DETAIL_EXPENDITURE
		  where MEMBER_ID = #{memberId} and REG_DATE BETWEEN '20-09-01'and '21-08-31'
		   group by member_id, category
	</select>
	
	<select id="ageSelect" parameterType="expenseVO" resultMap="expenseMap">
		select substr(rrn,1,2) type 
		 from cm_member 
		  where id = #{memberId}
	</select>
	
	<select id="ageChartData" parameterType="expenseVO" resultMap="expenseMap">
		select round(sum(cost)/(select count(*) from (select member_id from CM_DETAIL_EXPENDITURE where member_id in(select id from cm_member where substr(rrn,1,2) between #{start} and #{last}) group by member_id)),-1) expense, category
         from CM_DETAIL_EXPENDITURE
          where REG_DATE BETWEEN '21-08-01'and '21-08-31' and member_id in(select id from cm_member where substr(rrn,1,2) between #{start} and #{last})
           group by category
	</select>
	
</mapper>